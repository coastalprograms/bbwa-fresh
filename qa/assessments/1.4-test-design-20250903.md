# Test Design: Story 1.4

Date: 2025-09-03
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 23
- Unit tests: 8 (35%)
- Integration tests: 10 (43%)
- E2E tests: 5 (22%)
- Priority distribution: P0: 12, P1: 8, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: Build token-based public portal following existing QR code patterns

#### Scenarios

| ID           | Level       | Priority | Test                                  | Justification                    |
| ------------ | ----------- | -------- | ------------------------------------- | -------------------------------- |
| 1.4-UNIT-001 | Unit        | P0       | Validate token format (UUID)         | Pure validation logic            |
| 1.4-UNIT-002 | Unit        | P0       | Check token expiry calculation        | Date/time calculation logic      |
| 1.4-INT-001  | Integration | P0       | Token lookup against swms_jobs table | Database query validation        |
| 1.4-INT-002  | Integration | P0       | Handle invalid/expired tokens        | Error response validation        |
| 1.4-E2E-001  | E2E         | P0       | Access portal with valid token       | Critical authentication journey  |
| 1.4-E2E-002  | E2E         | P1       | Redirect on invalid token            | Security boundary validation     |

### AC2: Implement mobile-optimized file upload interface

#### Scenarios

| ID           | Level       | Priority | Test                              | Justification                 |
| ------------ | ----------- | -------- | --------------------------------- | ----------------------------- |
| 1.4-UNIT-003 | Unit        | P0       | File type validation logic        | Business rule validation      |
| 1.4-UNIT-004 | Unit        | P0       | File size validation (10MB limit) | Size constraint validation    |
| 1.4-INT-003  | Integration | P1       | Upload file to Supabase Storage   | Storage service integration   |
| 1.4-INT-004  | Integration | P1       | Generate signed URLs for files    | URL generation service        |
| 1.4-E2E-003  | E2E         | P0       | Complete file upload on mobile     | Critical mobile user journey  |
| 1.4-INT-005  | Integration | P2       | Camera integration for documents   | Mobile hardware integration   |

### AC3: Create submission confirmation and status tracking

#### Scenarios

| ID           | Level       | Priority | Test                              | Justification                |
| ------------ | ----------- | -------- | --------------------------------- | ---------------------------- |
| 1.4-UNIT-005 | Unit        | P1       | Generate confirmation number      | ID generation logic          |
| 1.4-INT-006  | Integration | P0       | Send confirmation email           | Email service integration    |
| 1.4-INT-007  | Integration | P1       | Create submission record          | Database insert operation    |
| 1.4-E2E-004  | E2E         | P1       | View confirmation page            | User feedback validation     |
| 1.4-INT-008  | Integration | P2       | Download submission receipt       | PDF generation service       |

### AC4: Implement proper security validations and virus scanning

#### Scenarios

| ID           | Level       | Priority | Test                                | Justification                  |
| ------------ | ----------- | -------- | ----------------------------------- | ------------------------------ |
| 1.4-UNIT-006 | Unit        | P0       | CSRF token validation              | Security logic validation      |
| 1.4-UNIT-007 | Unit        | P0       | Rate limiting algorithm            | Abuse prevention logic         |
| 1.4-INT-009  | Integration | P0       | Virus scanning service integration | External security service      |
| 1.4-INT-010  | Integration | P0       | File quarantine system             | Security response mechanism    |
| 1.4-E2E-005  | E2E         | P0       | Block malicious file upload        | End-to-end security validation |

### AC5: Store submissions in swms_submissions table with audit logging

#### Scenarios

| ID           | Level       | Priority | Test                            | Justification               |
| ------------ | ----------- | -------- | ------------------------------- | --------------------------- |
| 1.4-UNIT-008 | Unit        | P1       | Audit log entry formatting      | Data structure validation   |
| 1.4-INT-011  | Integration | P0       | Insert submission record        | Database operation          |
| 1.4-INT-012  | Integration | P0       | Create audit log entries        | Compliance logging          |
| 1.4-INT-013  | Integration | P1       | Trigger status change events    | Database trigger validation |
| 1.4-INT-014  | Integration | P2       | Data retention policy execution | Compliance automation       |

## Risk Coverage

**Security Risks (High Priority)**:
- Unauthorized access: Covered by 1.4-E2E-001, 1.4-E2E-002
- File-based attacks: Covered by 1.4-INT-009, 1.4-E2E-005
- Data breaches: Covered by 1.4-UNIT-006, 1.4-INT-010

**Business Risks (Medium Priority)**:
- Mobile usability failures: Covered by 1.4-E2E-003
- Data loss: Covered by 1.4-INT-011, 1.4-INT-012
- Compliance failures: Covered by 1.4-INT-013, 1.4-INT-014

## Recommended Execution Order

1. **P0 Unit tests (fail fast)**:
   - Token validation (1.4-UNIT-001, 1.4-UNIT-002)
   - File validation (1.4-UNIT-003, 1.4-UNIT-004)
   - Security validation (1.4-UNIT-006, 1.4-UNIT-007)

2. **P0 Integration tests**:
   - Authentication (1.4-INT-001, 1.4-INT-002)
   - Email notifications (1.4-INT-006)
   - Security services (1.4-INT-009, 1.4-INT-010)
   - Data storage (1.4-INT-011, 1.4-INT-012)

3. **P0 E2E tests**:
   - Portal access (1.4-E2E-001)
   - File upload journey (1.4-E2E-003)
   - Security boundaries (1.4-E2E-005)

4. **P1 tests** in order of business criticality
5. **P2 tests** as time and resources permit

## Coverage Validation

✅ **Complete Coverage**: All 5 acceptance criteria have comprehensive test scenarios
✅ **No Duplication**: Each test addresses distinct functionality at appropriate level
✅ **Risk Mitigation**: Critical security and business risks are adequately covered
✅ **Mobile Focus**: Dedicated mobile testing scenarios included
✅ **Compliance**: Audit logging and data retention requirements covered

## Test Implementation Notes

- Mock external virus scanning service for consistent test execution
- Use test database with isolated submission records
- Mobile testing requires device simulation and touch event testing
- Security tests should include penetration testing approaches
- Performance testing recommended for file upload scenarios (not included in core scenarios)